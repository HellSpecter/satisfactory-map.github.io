<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Satisfactory Map</title>
  <style>
    body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
    #map-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
    }
    #map {
      position: absolute;
      transform-origin: 0 0;
      /* Не задаем ширину - управляем через transform */
    }
    .checkpoint {
      position: absolute;
      background: red;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      /* Рассчитываем размер относительно scale (20px при zoom=1) */
    }
    /* Кастомная подсказка вместо стандартного title (лучше выглядит) */
    .checkpoint:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: sans-serif;
      font-size: 12px;
      white-space: nowrap;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div id="map-container">
    <img src="images/map.jpg" id="map">
    <!-- Координаты: x=1024 y=1212 и x=1869 y=788 (реальные пиксели карты) -->
    <div class="checkpoint" data-x="1024" data-y="1212" data-tooltip="Заглушка 1 (Generator Zone)"></div>
    <div class="checkpoint" data-x="1869" data-y="788" data-tooltip="Заглушка 2 (Assembly Line Start)"></div>
  </div>

  <script>
    // Настройки (соответствуют вашим параметрам)
    const MAP_SIZE = 5112;
    const MIN_SCALE = 0.5;
    const MAX_SCALE = 8;
    
    const container = document.getElementById('map-container');
    const map = document.getElementById('map');
    const checkpoints = document.querySelectorAll('.checkpoint');
    
    let scale = 1;
    let positionX = 0;
    let positionY = 0;

    // Центрируем карту при загрузке (ключевой момент!)
    window.addEventListener('load', () => {
      positionX = (container.offsetWidth / 2) - MAP_SIZE / 2;
      positionY = (container.offsetHeight / 2) - MAP_SIZE / 2;
      updatePositions();
    });

    // Колесико мыши (с зумом вокруг точки мыши)
    container.addEventListener('wheel', e => {
      e.preventDefault();
      const rect = container.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;
      
      const oldScale = scale;
      scale *= e.deltaY > 0 ? 0.92 : 1.08;
      scale = Math.min(MAX_SCALE, Math.max(MIN_SCALE, scale));
      
      // Критически важно: корректируем позицию для зума "в точку"
      positionX = mouseX - (mouseX - positionX) * (scale / oldScale);
      positionY = mouseY - (mouseY - positionY) * (scale / oldScale);
      
      updatePositions();
    });

    // Перемещение ЛКМ
    let isDragging = false;
    container.addEventListener('mousedown', e => {
      if (e.button !== 0) return; // Только ЛКМ
      isDragging = true;
      lastMouse = { x: e.clientX, y: e.clientY };
    });

    document.addEventListener('mousemove', e => {
      if (!isDragging) return;
      
      const deltaX = e.clientX - lastMouse.x;
      const deltaY = e.clientY - lastMouse.y;
      
      positionX -= deltaX / scale;
      positionY -= deltaY / scale;
      
      lastMouse = { x: e.clientX, y: e.clientY };
      updatePositions();
    });

    document.addEventListener('mouseup', () => isDragging = false);

    function updatePositions() {
      // Обновляем изображение
      map.style.transform = `translate(${positionX}px, ${positionY}px) scale(${scale})`;
      
      // Обновляем чекбоксы (главная сложность!)
      checkpoints.forEach(cp => {
        const x = parseFloat(cp.dataset.x);
        const y = parseFloat(cp.dataset.y);
        
        cp.style.left = `${x * scale + positionX}px`;
        cp.style.top = `${y * scale + positionY}px`;
        // Авто-меняем размер чекбокса (не исчезает при zoom)
        const size = 20 / scale;
        cp.style.width = `${size}px`;
        cp.style.height = `${size}px`;
      });
    }
  </script>
</body>
</html>
